import{r as e,j as t,P as n,R as r,C as a,B as s,O as i}from"./index-2a561653.js";import{R as c}from"./index-fbebeaa1.js";import{U as l}from"./index-e4ffde76.js";import{C as o}from"./ColorPicker-c0ad22f2.js";import"./useForceUpdate-2e74d350.js";import"./DeleteOutlined-900530c2.js";import"./CheckOutlined-777876c7.js";import"./index-660ccea8.js";import"./index-044c9330.js";import"./List-04044699.js";import"./index-594c817f.js";const u={"canvas-page":"_canvas-page_qiufh_1","canvas-tools":"_canvas-tools_qiufh_7","canvas-body":"_canvas-body_qiufh_13","canvas-wrap":"_canvas-wrap_qiufh_20","main-canvas":"_main-canvas_qiufh_32","img-canvas":"_img-canvas_qiufh_36","save-canvas":"_save-canvas_qiufh_41","active-btn":"_active-btn_qiufh_46"},d=(e,t)=>{const{startX:n,startY:r,endX:a,endY:s}=t,{centerX:i,centerY:c,width:l,height:o}=((e,t,n,r)=>({centerX:(e+n)/2,centerY:(t+r)/2,width:Math.abs(n-e),height:Math.abs(r-t)}))(n,r,a,s);e.beginPath(),e.ellipse(i,c,l/2,o/2,0,0,2*Math.PI),e.stroke()},h=()=>{const h=e.useRef(null),g=e.useRef(null),m=e.useRef(null);let[v,x]=e.useState(null),[j,f]=e.useState(null),[p,w]=e.useState(null);const[C,b]=e.useState(1),[_,R]=e.useState(1),[k,S]=e.useState("thin"),[X,Y]=e.useState("#000");let F=e.useRef(null);const[y,B]=e.useState(!1),[D,E]=e.useState("line"),I=()=>{v.clearRect(0,0,h.current.width,h.current.height),j.clearRect(0,0,h.current.width,h.current.height),p.clearRect(0,0,h.current.width,h.current.height)};let L=()=>{};const N=()=>{let e=h.current.offsetWidth,t=h.current.offsetHeight;b(e/800),R(t/600)},q=()=>{null!==F.current&&(cancelAnimationFrame(F.current),F.current=null)};let A=e.useRef(5),P=e.useRef(0);const O=()=>{const e=150;y||(null==v||v.clearRect(P.current,100,e,e),P.current+=A.current,v.fillStyle="blue",v.fillRect(P.current,100,e,e),(P.current+e>=h.current.width||P.current<=0)&&(A.current=-A.current),F.current=requestAnimationFrame((()=>{O()})))};const M=e=>{const t=h.current.getBoundingClientRect();return{x:(e.pageX-t.left)/C,y:(e.pageY-t.top)/_}};return e.useEffect((()=>{var e;return null==(e=h.current)||e.getContext,N(),window.addEventListener("resize",N),x((()=>{var e;let t=null==(e=h.current)?void 0:e.getContext("2d");return t.fillStyle="rgba(255, 255, 255, 0)",t.imageSmoothingEnabled=!0,t.lineJoin="round",t.lineCap="round",t.strokeStyle=X,t})),f((()=>{var e;return null==(e=g.current)?void 0:e.getContext("2d")})),w((()=>{var e;return null==(e=m.current)?void 0:e.getContext("2d")})),()=>{L(),window.removeEventListener("resize",N),q()}}),[]),t.jsx(n,{children:t.jsxs("div",{className:u["canvas-page"],children:[t.jsxs("div",{className:u["canvas-tools"],children:[t.jsxs(r,{align:"middle",gutter:8,style:{marginTop:10,marginBottom:10},children:[t.jsx(a,{children:t.jsxs(c.Group,{value:D,onChange:e=>{E(e.target.value)},children:[t.jsx(c.Button,{value:"line",children:"线"}),t.jsx(c.Button,{value:"circle",children:"圆"})]})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{v.globalCompositeOperation="destination-out",v.lineWidth=30,S("eraser")},className:"eraser"===k?u["active-btn"]:u["default-btn"],children:"橡皮擦"})}),t.jsx(a,{children:t.jsx(s,{onClick:I,children:"清除画布"})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{y?function(){if(!y)return;q()}():O(),B((e=>!e))},children:y?"方块暂停":"方块移动"})}),t.jsx(a,{children:t.jsx(l,{accept:"image/*",showUploadList:!1,onChange:e=>{const t=e.file.originFileObj;if(!t)return;const n=new FileReader;n.onload=e=>{const t=new Image;t.src=e.target.result,t.onload=()=>{const e=h.current.width,n=h.current.height;g.current.getContext("2d").drawImage(t,0,0,e,n)}},n.readAsDataURL(t)},children:t.jsx(s,{children:"绘制背景图片"})})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{const e=j.getImageData(0,0,g.current.width,g.current.height);p.putImageData(e,0,0),p.drawImage(h.current,0,0,h.current.width,h.current.height);let t=m.current.toDataURL();const n=window.document.createElement("a");n.href=t,n.download="签名.png",n.click()},children:"保存"})})]}),t.jsxs(r,{align:"middle",gutter:8,children:[t.jsx(a,{children:t.jsx(o,{onChange:e=>(e=>{Y(e),v.strokeStyle=e})(e.toHexString()),value:X,presets:[{label:"快速选择",colors:["#000000","#F5222D","#FA8C16","#FADB14","#8BBB11","#52C41A","#13A8A8","#1677FF","#2F54EB","#722ED1"]}],showText:!0})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{v.globalCompositeOperation="source-over",v.lineWidth=20,S("bold")},className:"bold"===k?u["active-btn"]:u["default-btn"],children:"粗线条"})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{v.globalCompositeOperation="source-over",v.lineWidth=1,S("thin")},className:"thin"===k?u["active-btn"]:u["default-btn"],children:"细线条"})}),t.jsx(a,{children:t.jsx(s,{onClick:()=>{null==v||v.beginPath(),null==v||v.arc(100,75,50,0,2*Math.PI),null==v||v.stroke(),null==v||v.fill()},children:"生成圆"})})]})]}),t.jsx("div",{className:u["canvas-body"],children:t.jsxs("div",{className:u["canvas-wrap"],children:[t.jsxs("canvas",{ref:h,width:800,height:600,onMouseDown:e=>{if(!v)return;const t=h.current.getBoundingClientRect();let n=(e.pageX-t.left)/C,r=(e.pageY-t.top)/_,a=n,s=r;if("line"===D&&(L=i((e=>{const{x:t,y:n}=M(e);((e,t)=>{const{startX:n,startY:r,endX:a,endY:s}=t;e.beginPath(),e.moveTo(n,r),e.lineTo(a,s),e.stroke()})(v,{startX:a,startY:s,endX:t,endY:n}),a=t,s=n}),(()=>{v.closePath()}))),"circle"===D){let e={startX:n,startY:r,endX:n,endY:r};const t=t=>{const{x:n,y:r}=M(t);e.endX=n,e.endY=r,I(),v.putImageData(s,0,0),d(v,e)},a=()=>{window.removeEventListener("mousemove",t),window.removeEventListener("mouseup",a)},s=v.getImageData(0,0,h.current.width,h.current.height);window.addEventListener("mousemove",t),window.addEventListener("mouseup",a)}},className:u["main-canvas"],children:["当前浏览器不支持canvas,请下载最新的浏览器",t.jsx("a",{href:"https://www.google.cn/chrome/index.html",children:"立即下载"})]}),t.jsx("canvas",{ref:g,width:800,height:600,className:u["img-canvas"]}),t.jsx("canvas",{ref:m,width:800,height:600,className:u["save-canvas"]})]})})]})})};export{h as default};
