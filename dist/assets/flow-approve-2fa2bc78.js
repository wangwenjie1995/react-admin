var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,d=(t,r,o)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[r]=o,p=(e,t)=>{for(var r in t||(t={}))a.call(t,r)&&d(e,r,t[r]);if(o)for(var r of o(t))s.call(t,r)&&d(e,r,t[r]);return e},l=(e,o)=>t(e,r(o));import{j as i,H as n,B as c,p as y,I as x,r as b,Z as h,P as f,a1 as u,c as v}from"./index-2a561653.js";import{l as m,L as g}from"./index-d0f7869e.js";import{S as j}from"./index-044c9330.js";import"./List-04044699.js";import"./CheckOutlined-777876c7.js";const N=[{type:"apply",label:"申请",style:{width:"30px",height:"30px",borderRadius:"15px",border:"2px solid #FF6347"},property:{username:"",time:"",startTime:"",endTime:""}},{type:"approver",label:"审批",style:{width:"50px",height:"40px",borderRadius:"4px",border:"2px solid #3CB371"}},{type:"jugement",label:"判断",style:{width:"30px",height:"30px",border:"2px solid #6495ED",transform:"rotate(45deg)"}},{type:"finsh",label:"结束",style:{width:"30px",height:"30px",borderRadius:"15px",border:"2px solid #FF6347"}}],w=[{label:"直接上级",value:"leader"},{label:"T3领导",value:"t3Leader"},{label:"T2领导",value:"t2Leader"},{label:"T1领导",value:"t1Leader"}],P={nodes:[{id:"28df2fbe-f32b-4a9b-b544-7e70d7187b33",type:"apply",x:210,y:210,text:{x:210,y:210,value:"申请"},properties:{}},{id:"64179bd7-c60e-433c-8df7-97c8e98f855d",type:"approver",x:350,y:210,text:{x:350,y:210,value:"审批"},properties:{labelColor:"#000000",approveTypeLabel:"直接上级",approveType:"leader"}},{id:"fcb96f10-720e-40e5-8ed0-ebdd0a46f234",type:"jugement",x:510,y:210,text:{x:510,y:210,value:"判断报销是否\n大于1000元"},properties:{api:""}},{id:"9f119df3-c449-4e5d-a67a-cb351b9cbdb5",type:"approver",x:670,y:210,text:{x:670,y:210,value:"审批"},properties:{labelColor:"#000000",approveTypeLabel:"T2领导",approveType:"t2Leader"}},{id:"ef34f09c-38ea-4ad4-acd2-cc2f464a2be6",type:"finsh",x:850,y:210,text:{x:850,y:210,value:"结束"},properties:{}}],edges:[{id:"0d87b1eb-2389-445a-9f34-6227940b2072",type:"polyline",sourceNodeId:"28df2fbe-f32b-4a9b-b544-7e70d7187b33",targetNodeId:"64179bd7-c60e-433c-8df7-97c8e98f855d",startPoint:{x:235,y:210},endPoint:{x:300,y:210},text:{x:51.25,y:0,value:""},properties:{},pointsList:[{x:235,y:210},{x:300,y:210}]},{id:"d99e7451-b379-411e-b0da-df11be8be20a",type:"polyline",sourceNodeId:"64179bd7-c60e-433c-8df7-97c8e98f855d",targetNodeId:"fcb96f10-720e-40e5-8ed0-ebdd0a46f234",startPoint:{x:400,y:210},endPoint:{x:475,y:210},text:{x:437.5,y:210,value:"通过"},properties:{},pointsList:[{x:400,y:210},{x:475,y:210}]},{id:"4c615802-15d8-442c-be22-b65430286123",type:"polyline",sourceNodeId:"fcb96f10-720e-40e5-8ed0-ebdd0a46f234",targetNodeId:"9f119df3-c449-4e5d-a67a-cb351b9cbdb5",startPoint:{x:545,y:210},endPoint:{x:620,y:210},text:{x:582.5,y:210,value:"是"},properties:{},pointsList:[{x:545,y:210},{x:620,y:210}]},{id:"934ae03a-6ee0-4568-a2b4-8bcede565e0b",type:"polyline",sourceNodeId:"9f119df3-c449-4e5d-a67a-cb351b9cbdb5",targetNodeId:"ef34f09c-38ea-4ad4-acd2-cc2f464a2be6",startPoint:{x:720,y:210},endPoint:{x:825,y:210},text:{x:-10,y:0,value:""},properties:{},pointsList:[{x:720,y:210},{x:825,y:210}]},{id:"bd5e1dd0-1978-46f7-851b-d31c03aebee9",type:"polyline",sourceNodeId:"64179bd7-c60e-433c-8df7-97c8e98f855d",targetNodeId:"ef34f09c-38ea-4ad4-acd2-cc2f464a2be6",startPoint:{x:350,y:170},endPoint:{x:850,y:185},text:{x:600,y:140,value:"驳回"},properties:{},pointsList:[{x:350,y:170},{x:350,y:140},{x:850,y:140},{x:850,y:185}]},{id:"453139c3-faa1-4e3a-a413-38f251243baa",type:"polyline",sourceNodeId:"fcb96f10-720e-40e5-8ed0-ebdd0a46f234",targetNodeId:"ef34f09c-38ea-4ad4-acd2-cc2f464a2be6",startPoint:{x:510,y:245},endPoint:{x:850,y:235},text:{x:680,y:275,value:"否"},properties:{},pointsList:[{x:510,y:245},{x:510,y:275},{x:850,y:275},{x:850,y:235}]}]};function C(e,t,r){var o;return i.jsxs("div",{children:[i.jsx("h2",{children:"属性面板"}),i.jsxs(n,{initialValues:e.properties,onValuesChange:(r,o)=>{w.forEach((e=>{e.value===r.approveType&&(r.approveTypeLabel=e.label)})),t(e.id,r)},children:[i.jsxs("span",{className:"form-property",children:["类型：",i.jsx("span",{children:e.type})]}),i.jsxs("span",{className:"form-property",children:["文案：",i.jsx("span",{children:null==(o=e.text)?void 0:o.value})]}),"approver"===e.type?(()=>{const e=[];w.forEach((t=>{e.push(i.jsx(j.Option,{value:t.value,children:t.label}))}));return i.jsx(n.Item,{className:"form-property",label:"审核节点类型",name:"approveType",children:i.jsx(j,{children:e})})})():"","jugement"===e.type?i.jsx(n.Item,{label:"API",name:"api",children:i.jsx(x,{})}):""]},e.id),i.jsxs("div",{children:[i.jsx("h3",{children:"......"}),i.jsx("h3",{children:"业务属性可根据需要进行自定义扩展"})]}),i.jsx("div",{className:"property-panel-footer",children:i.jsx(c,{className:"property-panel-footer-hide",type:"primary",icon:i.jsx(y,{}),onClick:r,children:"收起"})})]})}function L(e){return(()=>{const t=[];return N.forEach(((r,o)=>{t.push(i.jsxs("div",{className:`approve-node node-${r.type}`,children:[i.jsx("div",{className:"node-shape",style:p({},r.style),onMouseDown:()=>(t=>{e.dnd.startDrag({type:t.type,text:t.label})})(r)}),i.jsx("div",{className:"node-label",children:r.label})]},o))})),t})()}function T(e){class t extends m.CircleNodeModel{getConnectedTargetRules(){const e=super.getConnectedTargetRules();return e.push({message:"开始节点只能连出，不能连入！",validate:(e,t)=>{let r=!0;return t&&(r=!1),r}}),e}}e.register({type:"apply",view:m.CircleNode,model:t});class r extends m.RectNode{getLabelShape(){const{x:e,y:t,width:r,height:o,properties:a}=this.props.model,{labelColor:s,approveTypeLabel:d}=a;return m.h("text",{fill:s,fontSize:12,x:e-r/2+5,y:t-o/2+15,width:50,height:25},d)}getShape(){const{x:e,y:t,width:r,height:o,radius:a}=this.props.model,s=this.props.model.getNodeStyle();return m.h("g",{},[m.h("rect",l(p({},s),{x:e-r/2,y:t-o/2,rx:a,ry:a,width:r,height:o})),this.getLabelShape()])}}var o;d(r,"symbol"!=typeof(o="extendKey")?o+"":o,"UserTaskNode");class a extends m.RectNodeModel{constructor(e,t){super(e,t),this.properties={labelColor:"#000000",approveTypeLabel:"",approveType:""}}}e.register({type:"approver",view:r,model:a});class s extends m.PolygonNodeModel{constructor(e,t){super(e,t),this.points=[[35,0],[70,35],[35,70],[0,35]],this.properties={api:""}}}e.register({type:"jugement",view:m.PolygonNode,model:s});class i extends m.CircleNodeModel{getConnectedSourceRules(){const e=super.getConnectedSourceRules();return e.push({message:"结束节点只能连入，不能连出！",validate:e=>{let t=!0;return e&&(t=!1),t}}),e}}e.register({type:"finsh",view:m.CircleNode,model:i})}const I={stopScrollGraph:!0,stopZoomGraph:!0,grid:{size:10,visible:!0,type:"mesh",config:{color:"#DCDCDC"}},keyboard:{enabled:!0},style:{rect:{radius:8,stroke:"#3CB371"},circle:{r:25,stroke:"#FF6347"},polygon:{stroke:"#6495ED"},polyline:{strokeWidth:1},edgeText:{background:{fill:"white"}}}};function O(){const[e,t]=b.useState({}),[r,o]=b.useState();b.useEffect((()=>{const e=new g(l(p({},I),{container:document.querySelector("#graphApprove")}));t(e),T(e),e.render(P),a(e)}),[]);const a=e=>{e.on("element:click",(({data:e})=>{o(e)})),e.on("connection:not-allowed",(e=>{h.error(e.msg)}))};return i.jsxs("div",{className:"approve-example-container",children:[i.jsx("div",{className:"node-panel",children:L(e)}),i.jsx("div",{id:"graphApprove",className:"viewport"}),r?i.jsx("div",{className:"property-panel",children:C(r,((t,r)=>{const o=e.graphModel.nodesMap[t],a=e.graphModel.edgesMap[t];o?o.model.setProperties(Object.assign(o.model.properties,r)):a&&a.model.setProperties(Object.assign(a.model.properties,r))}),(()=>{o(void 0)}))}):""]})}const S=()=>i.jsx(f,{plugin:u,children:i.jsx(v,{bordered:!1,children:i.jsx("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"500px"},children:i.jsx(O,{})})})});export{S as default};
