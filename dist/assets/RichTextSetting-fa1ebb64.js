var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,a=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,i=(e,t)=>{for(var n in t||(t={}))l.call(t,n)&&a(e,n,t[n]);if(o)for(var n of o(t))r.call(t,n)&&a(e,n,t[n]);return e},s=(e,o)=>t(e,n(o));import{r as c,j as d,h,H as f,N as u,B as x,bf as p,D as m}from"./index-2a561653.js";import{i as g}from"./use-immer.module-8d0067f5.js";import{R as y}from"./index-59cbb00b.js";import{u as w}from"./index-b5149bc8.js";import{S as b}from"./index-044c9330.js";import{C as j}from"./ColorPicker-c0ad22f2.js";const _={"rnd-node-wrapper":"_rnd-node-wrapper_17f27_1",active:"_active_17f27_5",handler:"_handler_17f27_8","handler-n":"_handler-n_17f27_20","handler-e":"_handler-e_17f27_26","handler-s":"_handler-s_17f27_33","handler-w":"_handler-w_17f27_40","handler-ne":"_handler-ne_17f27_47","handler-nw":"_handler-nw_17f27_54","handler-se":"_handler-se_17f27_61","handler-sw":"_handler-sw_17f27_68"};var v=(e=>(e.n="top",e.e="right",e.s="bottom",e.w="left",e.nw="topLeft",e.ne="topRight",e.se="bottomRight",e.sw="bottomLeft",e))(v||{});const C=e=>{const{element:t,children:n,handlers:o=["n","e","s","w","ne","nw","se","sw"],onChange:l}=e,{x:r=0,y:a=0,w:f=100,h:u=28}=t,x=c.useRef(null),p=`rndNode_${c.useId()}`,[m,w]=g({x:r,y:a,width:f,height:u}),[b,j]=c.useState(t.active);c.useEffect((()=>{w((e=>{e.x=r,e.y=a,e.width=f,e.height=u}))}),[r,a,f,u]),c.useEffect((()=>{j(t.active)}),[t.active]),c.useEffect((()=>{"text"===t.type&&z({x:m.x,y:m.y})}),[t]),c.useEffect((()=>{null==l||l(s(i({},t),{x:m.x,y:m.y,w:m.width,h:m.height,active:b}))}),[b,m]),c.useEffect((()=>{const e=document.querySelector(".rnd-container")||document.documentElement;return e.addEventListener("mousedown",k,!1),()=>{e.removeEventListener("mousedown",k,!1)}}));const C=o.reduce(((e,t)=>(e[v[t]]=`${_.handler} ${_[`handler-${t}`]}`,e)),{}),S=o.reduce(((e,t)=>(e[v[t]]=!0,e)),{}),k=e=>{const t=e.target,n=document.getElementById(p);(null==n?void 0:n.contains(t))?!b&&j(!0):b&&j(!1)},z=e=>{var n,o;const l=document.getElementById(p);if(l&&"text"===t.type){const t=Math.ceil(null==(n=l.parentNode)?void 0:n.getBoundingClientRect().height),r=Math.ceil(l.querySelector(".rich-text-input").getBoundingClientRect().height);e.y+r>=t&&(w((e=>{e.y=t-r})),null==(o=x.current)||o.updatePosition({y:m.y})),l.style.height=`${r}px`,w((e=>{e.height=r}))}};return d.jsx(y,{ref:x,id:p,default:i({},m),minWidth:80,minHeight:24,bounds:"parent",enableResizing:i({},S),resizeHandleClasses:i({},C),className:h(_["rnd-node-wrapper"],{[_.active]:b}),onResize:(e,n,o,l,r)=>{"text"===t.type&&z(r)},onResizeStop:(e,n,o,l,r)=>{w((e=>{e.width=o.offsetWidth,e.height=o.offsetHeight,e.x=r.x,e.y=r.y})),"text"===t.type&&z(r)},onDragStop:(e,t)=>{w((e=>{e.x=t.x,e.y=t.y}))},children:n})};const S=({value:e="请输入文本",style:t={},hasBorder:n=!1,onChange:o})=>{const l=c.useMemo((()=>i(i({minHeight:"20px",padding:"6px 8px",outline:"none",wordBreak:"break-all"},n?{border:"1px solid #d9d9d9",borderRadius:"6px"}:{}),t)),[t]),{run:r}=w((e=>{o(e.target.innerHTML)}),{wait:200});return d.jsx("div",{dangerouslySetInnerHTML:{__html:e},className:"rich-text-input",style:i({},l),contentEditable:!0,spellCheck:"false",onPaste:e=>{e.preventDefault();const t=function(e){const t=e.clipboardData||window.clipboardData;let n="";return t&&t.getData&&(n=t.getData("text/plain")),n}(e);o(t),setTimeout((()=>{!function(e){if(window.getSelection){e.focus();const t=window.getSelection();null==t||t.selectAllChildren(e),null==t||t.collapseToEnd()}else if(document.selection){const t=document.selection.createRange();t.moveToElementText(e),t.collapse(!1),t.select()}}(e.target)}),0)},onInput:r})},k=[{key:"left",label:"左对齐"},{key:"center",label:"居中"},{key:"right",label:"右对齐"}],z=({textValue:e,textStyles:t={},onChangeValue:n,onChangeStyles:o})=>{const l=(e,n)=>{let l="";switch(e){case"fontWeight":l=n?"":"bold";break;case"fontStyle":l=n?"":"italic";break;case"textShadow":l=n?"":"1px 1px 1px #333"}null==o||o(s(i({},t),{[e]:l||""}))};return d.jsxs(f,{colon:!1,labelCol:{span:6},wrapperCol:{span:18},labelAlign:"left",style:{width:"300px",margin:"0 auto"},children:[d.jsx(f.Item,{label:"文本",children:d.jsx(S,{value:e,hasBorder:!0,onChange:e=>n(e)})}),d.jsx(f.Item,{label:"字体",children:d.jsx(b,{value:t.fontFamily,onChange:e=>null==o?void 0:o(s(i({},t),{fontFamily:e})),children:["黑体","宋体","楷体","隶书","微软雅黑","华文行楷","方正姚体"].map((e=>d.jsx(b.Option,{value:e,style:{fontFamily:e},children:e},e)))})}),d.jsx(f.Item,{label:"字号",children:d.jsx(b,{value:t.fontSize,onChange:e=>null==o?void 0:o(s(i({},t),{fontSize:e,lineHeight:e})),children:[12,14,16,20,24,32,48].map((e=>d.jsx(b.Option,{value:e+"px",style:{fontSize:e+"px"},children:e+"px"},e)))})}),d.jsx(f.Item,{label:"样式",children:d.jsxs(u,{size:6,children:[d.jsx(j,{onChange:(e,n)=>null==o?void 0:o(s(i({},t),{color:n})),children:d.jsx(x,{icon:d.jsx(p,{name:"color-font",size:20}),style:{color:t.color}})}),d.jsx(j,{onChange:(e,n)=>null==o?void 0:o(s(i({},t),{backgroundColor:n})),children:d.jsx(x,{icon:d.jsx(p,{name:"color-bg",size:20}),style:{color:t.backgroundColor}})}),d.jsx(x,{icon:d.jsx(p,{name:"font-bold",size:20}),style:{color:t.fontWeight?"#1890ff":""},onClick:()=>l("fontWeight",t.fontWeight)}),d.jsx(x,{icon:d.jsx(p,{name:"font-italic",size:20}),style:{color:t.fontStyle?"#1890ff":""},onClick:()=>l("fontStyle",t.fontStyle)}),d.jsx(x,{icon:d.jsx(p,{name:"font-shadow",size:20}),style:{color:t.textShadow?"#1890ff":""},onClick:()=>l("textShadow",t.textShadow)}),d.jsx(m,{menu:{items:k,selectedKeys:[t.textAlign],onClick:({key:e})=>{null==o||o(s(i({},t),{textAlign:e}))}},placement:"bottomRight",trigger:["click"],children:d.jsx(x,{icon:d.jsx(p,{name:"font-align",size:20})})})]})})]})};export{C as R,S as a,z as b};
